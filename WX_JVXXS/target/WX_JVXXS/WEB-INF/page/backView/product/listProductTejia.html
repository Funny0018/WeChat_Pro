<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../Static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../Static/css/back/product.css">
    <script src="../Static/js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="../Static/js/bootstrap.js"></script>
    <script src="../Static/js/tools.js"></script>
</head>
<body>
<div class="panel-heading">
    商品管理
</div>
<div class="choseProduct choseType" style="display: none;">
    <div class="showProductForCoupon">
        <ul class="productListForCoupon">

        </ul>
    </div>
    <div class="choseTypeCancel">取消</div>
</div>
<div class="panel-body">
    <!--<div class="my-container">-->
        <!--<label class="myLabel-content">商品类型：</label>-->
        <!--<ul id="productType">-->
        <!--</ul>-->
    <!--</div>-->
    <!--<div class="my-container">-->
        <!--<label class="myLabel-content">商品类型：</label>-->
        <!--<ul id="productTypeTwo">-->
        <!--</ul>-->
    <!--</div>-->
    <!--<div class="my-container">-->
        <!--<label class="myLabel-content">是否上架：</label>-->
        <!--<ul>-->
            <!--<li class='isSallIndex '>-->
                <!--<a role="menuitem" class="active" tabindex="1" href="#">上架商品</a>-->
            <!--</li>-->
            <!--<li class='isSallIndex'>-->
                <!--<a role="menuitem" tabindex="0" href="#">下架商品</a>-->
            <!--</li>-->
        <!--</ul>-->
    <!--</div>-->
    <!--<div class="my-container">-->
        <!--<label class="myLabel-content">是否热卖：</label>-->
        <!--<ul>-->
            <!--<li class='isHotIndex'>-->
                <!--<a role="menuitem" class="active" tabindex="-1" href="#">全部</a>-->
            <!--</li>-->
            <!--<li class='isHotIndex'>-->
                <!--<a role="menuitem" tabindex="1" href="#">热卖商品</a>-->
            <!--</li>-->
            <!--<li class='isHotIndex'>-->
                <!--<a role="menuitem" tabindex="0" href="#">非热卖商品</a>-->
            <!--</li>-->
        <!--</ul>-->
    <!--</div>-->
    <div class="my-container">
        <label class="myLabel-content">商品名称：</label>
        <div class="myText-content">
            <input id="productName" type="text" class="form-control" placeholder="输入商品名称">
        </div>
        <button id="search" type="button" class="btn btn-default btn-sm">
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>搜索
        </button>
    </div>
</div>
<div class="panel-body">
    <div class="list-op" id="list_op">
        <div class="buttonBox">
            <button type="button" class="btn btn-default btn-sm add">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
            </button>
            <button type="button" class="btn btn-default btn-sm edit">
                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
            </button>
            <button type="button" class="btn btn-default btn-sm delete">
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
            </button>
        </div>

        <div class="buttonBox">
            <button type="button" class="btn btn-default btn-sm downsall">
                <span class="glyphicon  glyphicon-arrow-down" aria-hidden="true"></span>下架
            </button>
            <button type="button" class="btn btn-default btn-sm onsall">
                <span class="glyphicon  glyphicon-arrow-up" aria-hidden="true"></span>上架
            </button>
        </div>

        <!--<div class="buttonBox">-->
            <!--<button type="button" class="btn btn-default btn-sm onhot">-->
                <!--<span class="glyphicon  glyphicon-arrow-up" aria-hidden="true"></span>加入热卖-->
            <!--</button>-->
            <!--<button type="button" class="btn btn-default btn-sm offhot">-->
                <!--<span class="glyphicon  glyphicon-arrow-up" aria-hidden="true"></span>移除热卖-->
            <!--</button>-->
        <!--</div>-->

        <!--<div class="buttonBox">-->
            <!--<button type="button" class="btn btn-default btn-sm setSortTop">-->
                <!--<span class="glyphicon glyphicon-home" aria-hidden="true"></span>商品置顶-->
            <!--</button>-->
            <!--<button type="button" class="btn btn-default btn-sm unSetSortTop">-->
                <!--<span class="glyphicon glyphicon-align-center" aria-hidden="true"></span>取消置顶-->
            <!--</button>-->
            <!--<button type="button" class="btn btn-default btn-sm setSortUp">-->
                <!--<span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>提升排序-->
            <!--</button>-->
            <!--<button type="button" class="btn btn-default btn-sm setSortDown">-->
                <!--<span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>降低排序-->
            <!--</button>-->
        <!--</div>-->
        <!--<div class="buttonBox">-->
            <!--<button type="button" class="btn btn-default btn-sm changeType">-->
                <!--<span class="glyphicon glyphicon-edit" aria-hidden="true"></span>更改分类-->
            <!--</button>-->
        <!--</div>-->
    </div>
</div>

<div class="panel-body">
    <table class="table  table-striped table-bordered">
        <thead>
        <tr>
            <th><input type="checkbox" id="checkAll" name="checkAll"/></th>
            <th style="display: none;">商品ID</th>
            <!--<th>商品分类</th>-->
            <th>商品名称</th>
            <th>商品描述</th>
            <th>商品图片</th>
            <!--<th>商品价格</th>-->
            <th>会员价格</th>
            <th>销售数量</th>
            <th>排序权重</th>
            <th>是否置顶</th>
        </tr>
        </thead>
        <tbody id="productList">
        </tbody>
    </table>
</div>
<div class="panel-body">
    <div class="page-header">显示第<span id="minCount">1</span>到第<span id="maxCount">10</span>条数据，共<span
            id="allCount">0</span>条数据，共<span id="maxPage">0</span>页 ，每页显示10 条记录
    </div>
    <ul class="pagination">
        <li><a href="#">&laquo;&laquo;</a></li>
        <li><a href="#">&laquo;</a></li>
        <li><a href="#">1</a></li>
        <li><a href="#">2</a></li>
        <li><a href="#">3</a></li>
        <li><a href="#">4</a></li>
        <li><a href="#">5</a></li>
        <li><a href="#">&raquo;</a></li>
        <li><a href="#">&raquo;&raquo;</a></li>
    </ul>
</div>
<div style="display: none">
    <div id="productTypeSelect">0</div>
    <div id="productIsSall">1</div>
    <div id="productIsHot">-1</div>
    <div id="pageIndex">1</div>
    <div id="pageCount">10</div>
    <div id="ache"></div>
</div>
</body>
</html>
<script type="text/javascript">
    $(document).ready(function () {
        getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
        // getProductType();

        $("#search").click(function () {
            getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
        });

        $(".add").click(function () {
            addProductDetail();
        })
        $(".edit").click(function () {
            toEdit("edit");
        })
        $(".delete").click(function () {
            var productid = getIds();
            if (productid == "") {
                alert("请选择需要删除的商品类型")
            } else {
                var j = confirm("是否确认删除？");
                if (j) {
                    editSalled(productid, -1);
                }
            }
        })
        $(".downsall").click(function () {
            var productid = getIds();
            if (productid == "") {
                alert("请选择需要下架的商品类型")
            } else {
                var j = confirm("是否确认下架？");
                if (j) {
                    editSalled(productid, 0);
                }
            }
        })
        $(".onsall").click(function () {
            var productid = getIds();
            if (productid == "") {
                alert("请选择需要上架的商品类型")
            } else {
                var j = confirm("是否确认上架？");
                if (j) {
                    editSalled(productid, 1);
                }
            }
        })
        $(".onhot").click(function () {
            var productid = getIds();
            if (productid == "") {
                alert("请选择需要热卖的商品类型")
            } else {
                editHot(productid, 1);
            }
        })
        $(".offhot").click(function () {
            var productid = getIds();
            if (productid == "") {
                alert("请选择需要移除热卖的商品类型")
            } else {
                editHot(productid, 0);
            }
        })
        $(".isSallIndex").click(function () {
            var obj = ($(this).find("a"))
            var index = obj.attr("tabindex");
            var name = obj.html();
            $("#pageIndex").html(1)
            $("#productIsSall").html(index);
            $(".isSallIndex ").find('a').removeClass('active');
            $(this).find('a').addClass('active');
            getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
        })
        $(".isHotIndex").click(function () {
            var obj = ($(this).find("a"))
            var index = obj.attr("tabindex");
            var name = obj.html();
            $("#pageIndex").html(1)
            $("#productIsHot").html(index);
            $(".isHotIndex ").find('a').removeClass('active');
            $(this).find('a').addClass('active');
            getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
        })
        $(".setSortTop").click(function () {
            var productid = getIds();
            if (productid == "") {
                alert("请选择需要置顶的商品")
            } else {
                editTop(productid, 1);
            }
        });
        $(".unSetSortTop").click(function () {
            var productid = getIds();
            if (productid == "") {
                alert("请选择需要移除置顶的商品")
            } else {
                editTop(productid, 0);
            }
        })
        $(".setSortUp").click(function () {
            var productid = getIds();
            if (productid == "") {
                alert("请选择需要提升排序的商品")
            } else {
                editSort(productid, 1);
            }
        })
        $(".setSortDown").click(function () {
            var productid = getIds();
            if (productid == "") {
                alert("请选择需要降低排序的商品")
            } else {
                editSort(productid, -1);
            }
        })
        $(".changeType").click(function () {
            var productid = getIds();
            if (productid == "") {
                alert("请选择需要修改分类的商品")
            } else {
                showType(productid);
            }
        })
        $(".choseTypeCancel").click(function () {
            $(".choseProduct").hide();
        })
    })

    function showType(productid) {
        $(".choseProduct").show();
        $.ajax({
            type: 'POST',
            // contentType: "application/json; charset=utf-8",
            contentType: "application/x-www-form-urlencoded",
            url: 'getAllProductType',
            dataType: "json",
            success: function (data) {
                var html = "<li><span style='font-weight: 800'>分类ID</span><span style='font-weight: 800'>分类名称</span><span style='font-weight: 800'>父级分类</span></li>";
                var dataObj = eval("(" + data.massage + ")");
                console.log(dataObj);
                $.each(dataObj, function (index, obj) {
                    html += "<li class='choseProductId' id='" + obj.ftypeid + "'><span>" + obj.ftypeid + "</span><span>" + obj.fName + "</span><span>" + obj.fparentname + "</span></li>";
                })
                $(".productListForCoupon").html(html);
                $(".choseProductId").click(function () {
                    editType(productid, $(this).attr("id"));
                    $(".choseProduct").hide();
                })
            }
        })
    }

    function editType(productid, typeid) {
        $.ajax({
            type: 'POST',
            // contentType: "application/json; charset=utf-8",
            contentType: "application/x-www-form-urlencoded",
            url: 'updateType',
            dataType: "json",
            data: {"key": productid, "typeid": typeid},
            success: function (data) {
                alert(data.massage);
            }
        })
    }

    function editSort(productid, sort) {
        $.ajax({
            type: 'POST',
            // contentType: "application/json; charset=utf-8",
            contentType: "application/x-www-form-urlencoded",
            url: 'updateSort',
            dataType: "json",
            data: {"key": productid, "sort": sort},
            success: function (data) {
                alert(data.massage);
                getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
            }
        })
    }

    function editTop(productid, sort) {
        $.ajax({
            type: 'POST',
            // contentType: "application/json; charset=utf-8",
            contentType: "application/x-www-form-urlencoded",
            url: 'updateTop',
            dataType: "json",
            data: {"key": productid, "top": sort},
            success: function (data) {
                alert(data.massage);
                getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
            }
        })
    }

    function editHot(productid, hot) {
        $.ajax({
            type: 'POST',
            // contentType: "application/json; charset=utf-8",
            contentType: "application/x-www-form-urlencoded",
            url: 'updatehot',
            dataType: "json",
            data: {"key": productid, "hot": hot},
            success: function (data) {
                alert(data.massage);
                getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
            }
        })
    }

    function editSalled(productid, salled) {
        $.ajax({
            type: 'POST',
            // contentType: "application/json; charset=utf-8",
            contentType: "application/x-www-form-urlencoded",
            url: 'editSalled',
            dataType: "json",
            data: {"key": productid, "issall": salled},
            success: function (data) {
                alert(data.massage);
                getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
            }
        })
    }

    function deleteProduct(productid) {
        $.ajax({
            type: 'POST',
            // contentType: "application/json; charset=utf-8",
            contentType: "application/x-www-form-urlencoded",
            url: 'deleteProduct',
            dataType: "json",
            data: {"key": productid},
            success: function (data) {
                alert(data.massage);
                getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
            }
        })
    }

    function toEdit(type) {
        var productid = getIds();
        if (productid != "") {
            productid = productid.substring(0, productid.length - 1);
        }
        console.log(productid);
        if (productid.split("|").length > 1) {
            alert("只可以选择一个选项")
        } else if (productid == "") {
            alert("请选择需要修改的商品")
        } else {
            window.location.href = "editProductTejia?type=" + type + "&id=" + productid;
        }
    }

    function getIds() {
        var id = "";
        $('input[type="checkbox"][name="checkProduct"]:checked').each(
            function () {
                id += $(this).parent().parent().attr("id") + "|";
            }
        );
        return id;
    }

    function getProduct(key, pageIndex, type, pageSize, issall, ishot) {
        $.ajax({
            type: 'POST',
            // contentType: "application/json; charset=utf-8",
            contentType: "application/x-www-form-urlencoded",
            url: 'getKeyProductTejia',
            dataType: "json",
            data: {
                "key": key,
                "pageIndex": pageIndex,
                "pageSize": pageSize,
                "issall": issall
            },
            success: function (data) {
                var dataObj = eval("(" + data.massage + ")");
                console.log(dataObj);
                var maxPage = data.maxPage * 1;
                var maxCount = data.maxCount * 1;
                var html = '';
                $.each(dataObj, function (index, obj) {
                    html += "    <tr id='" + obj.fProductId + "'>\n" +
                        "        <th style='display: none'>" + obj.fProductId + "</th>\n" +
                        // "        <th>" + obj.typename + "</th>\n" +
                        "        <th class='input-change'><input name='fname' class='table-input'  value='" + obj.fName + "'/></th>\n" +
                        "        <th class='input-change'><input name='fdesc'  class='table-input'  value='" + obj.fDesc + "'/></th>\n" +
                        "        <th><img style='width: 50px;height: 50px;' src='" + obj.fImgUrl + "' alt=''></th>\n" +
                        "        <th class='input-change'><input  name='fprice'  class='table-input price-input'  value='" + obj.fPrice + "'/></th>\n" +
                        // "        <th class='input-change'><input   name='fvipprice'   class='table-input price-input'  value='" + obj.fVipPrice + "'/></th>\n" +
                        "        <th class='input-change'><input   name='fsalled'   class='table-input price-input'  value='" + obj.fsalled + "'/></th>\n" +
                        "        <th class='input-change'><input   name='fsort'   class='table-input price-input'  value='" + obj.fsort + "'/></th>\n" +
                        "        <th ><input   name='fistop'   class='table-input price-input'  value='" + obj.fistop + "'/></th>\n" +
                        "    </tr>"
                })
                $("#productList").html(html);
                $("#minCount").html((pageIndex * 1 - 1) * pageSize + 1);
                $("#maxCount").html(pageIndex * pageSize);
                $("#allCount").html(maxCount);
                $("#maxPage").html(maxPage);

                $("#productList").find('.table-input').attr('disabled', true);
                $(".input-change").click(function () {
                    $("#productList").find('.table-input').attr('disabled', true);
                    $(this).find('input').attr('disabled', false);
                    $("#ache").html($(this).find('input').val());
                })
                $(".table-input").blur(function () {
                    $(this).attr('disabled', true);
                    var productID = $(this).parent().parent().attr('id');
                    var price = $(this).parent().parent().find("input[name=fprice]").val();
                    var vipprice = $(this).parent().parent().find("input[name=fvipprice]").val();
                    var type = $(this).attr('name');
                    var info = $(this).val();
                    switch (type) {
                        case "fname":
                            updateProductInfo(productID, type, info)
                            break;
                        case "fdesc":
                            updateProductInfo(productID, type, info)
                            break;
                        case "fprice":
                            if (fix_amountthis(info)) {
                                if (info * 1 >= vipprice * 1) {
                                    updateProductInfo(productID, type, info);
                                } else {
                                    alert("低于VIP价格！");
                                    $(this).val($("#ache").html());
                                }
                            } else {
                                alert("请输入有效金额");
                                getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
                            }
                            break;
                        case "fvipprice":
                            if (fix_amountthis(info)) {
                                if (info * 1 <= price * 1) {
                                    updateProductInfo(productID, type, info)
                                } else {
                                    alert("高于原价！");
                                    $(this).val($("#ache").html());
                                }
                            } else {
                                alert("请输入有效金额");
                                getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
                            }
                            break;
                        case "fvipprice":
                            if (fix_amountthis(info)) {
                                updateProductInfo(productID, type, info)
                            } else {
                                alert("请输入有效数值");
                                getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
                            }
                            break;
                        case "fsalled":
                            if (fix_amountthis(info)) {
                                updateProductInfo(productID, type, info)
                            } else {
                                alert("请输入有效数值");
                                getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
                            }
                            break;
                        case "fsort":
                            if (fix_amountthis(info)) {
                                updateProductInfo(productID, type, info)
                            } else {
                                alert("请输入有效数值");
                                getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
                            }
                            break;
                    }
                });

                var pages = "";
                if (maxPage <= 5) {
                    for (var i = 1; i <= maxPage; i++) {
                        pages += i + ",";
                    }
                } else if (maxPage > 5 && (pageIndex * 1 + 2) >= maxPage) {
                    for (var i = (maxPage - 5); i <= maxPage; i++) {
                        pages += i + ",";
                    }
                } else if (maxPage > 5 && (pageIndex - 2) <= 0) {
                    for (var i = 1; i <= 5; i++) {
                        pages += i + ",";
                    }
                } else {
                    for (var i = (pageIndex - 2); i <= (pageIndex * 1 + 2); i++) {
                        pages += i + ",";
                    }
                }
                var pageHtml = " <li class='toMinPage'><a href=\"#\">&laquo;&laquo;</a></li>\n" +
                    "                    <li class='toLastPage'><a href=\"#\">&laquo;</a></li>"
                $.each(pages.split(','), function (index, obj) {
                    if (obj != "") {
                        pageHtml += "<li class='toPage'><a href=\"#\">" + obj + "</a></li>\n";
                    }
                })
                pageHtml += "                    <li  class='toNextPage'><a href=\"#\"'>&raquo;</a></li>\n" +
                    "                    <li class='toMaxPage'><a href=\"#\">&raquo;&raquo;</a></li>";
                $(".pagination").html(pageHtml);
                $(".pagination").find("li").find("a").each(function (i) {
                    console.log($(this).html())
                    if ($(this).html() == $("#pageIndex").html()) {
                        $(this).addClass("active");
                    }
                })
                $(".toMinPage").click(function () {
                    var pageIndex = 1;
                    $("#pageIndex").html(pageIndex);
                    getProduct($("#productName").val(), pageIndex, $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
                });
                $(".toLastPage").click(function () {
                    var pageIndex = $("#pageIndex").html();
                    if (pageIndex <= 1) {
                        alert("当前为第一页");
                    } else {
                        $("#pageIndex").html(pageIndex - 1);
                        getProduct($("#productName").val(), pageIndex - 1, $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
                    }
                });
                $(".toPage").click(function () {
                    var pageIndex = $(this).find("a").html();
                    $("#pageIndex").html(pageIndex);
                    getProduct($("#productName").val(), pageIndex, $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
                })
                $(".toNextPage").click(function () {
                    var pageIndex = $("#pageIndex").html();
                    if (pageIndex == $("#maxPage").html()) {
                        alert("当前为最后一页")
                    } else {
                        $("#pageIndex").html(pageIndex * 1 + 1);
                        getProduct($("#productName").val(), pageIndex * 1 + 1, $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
                    }
                });
                $(".toMaxPage").click(function () {
                    var pageIndex = $("#maxPage").html();
                    $("#pageIndex").html(pageIndex);
                    getProduct($("#productName").val(), pageIndex, $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
                });


                initTableCheckbox();
            },
            error: function (jqXHR, textStatus, errorThrown) {
                // /*弹出jqXHR对象的信息*/
                // alert(jqXHR.responseText);
                // alert(jqXHR.status);
                // alert(jqXHR.readyState);
                // alert(jqXHR.statusText);
                // /*弹出其他两个参数的信息*/
                // alert(textStatus);
                // alert(errorThrown);

                alert('请求失败 ');
            }
        })
    }

    function updateProductInfo(id, type, info) {
        $.ajax({
            type: 'POST',
            // contentType: "application/json; charset=utf-8",
            contentType: "application/x-www-form-urlencoded",
            url: 'updateProductInfo',
            dataType: "json",
            data: {"id": id, "type": type, "info": info},
            success: function (data) {
                alert(data.massage);
                getProduct($("#productName").val(), pageIndex, $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
            }
        });
    }

    function addProductDetail() {
        $.ajax({
            type: 'POST',
            // contentType: "application/json; charset=utf-8",
            contentType: "application/x-www-form-urlencoded",
            url: 'addKeyProductTejia',
            dataType: "json",
            // data: {"key": key, "pageIndex": pageIndex, "type": type, "pageSize": pageSize},
            success: function (data) {
                console.log(data.massage);
                if (data.massage == '新增成功') {
                    alert("新增成功，请填写详细信息")
                    window.location.href = "editProductTejia?type=add&id=" + data.id;
                } else {
                    alert("后台错误，请联系系统管理员")
                }
            }
        });
    }

    function getProductType() {
        $.ajax({
            type: 'POST',
            // contentType: "application/json; charset=utf-8",
            contentType: "application/x-www-form-urlencoded",
            url: 'getProductType',
            dataType: "json",
            // data: {"key": key, "pageIndex": pageIndex, "type": type, "pageSize": pageSize},
            success: function (data) {
                var dataObj = eval("(" + data.massage + ")");
                var html = " <li class='productTypeIndex'>\n" +
                    "                        <a role=\"menuitem\" class='active' tabindex=\"0\" href=\"#\"> 全部</a>\n" +
                    "                    </li>";
                $.each(dataObj, function (index, obj) {
                    html += " <li class='productTypeIndex'>\n" +
                        "                        <a role=\"menuitem\" tabindex=\"" + obj.ftypeid + "\" href=\"#\"> " + obj.fName + "</a>\n" +
                        "                    </li>";
                })
                $("#productType").html(html);
                $(".productTypeIndex").click(function () {
                    $("#pageIndex").html('1')
                    var obj = ($(this).find("a"))
                    var index = obj.attr("tabindex");
                    $("#productTypeSelect").html(index);
                    $(".productTypeIndex").find("a").removeClass("active");
                    $(this).find("a").addClass("active");
                    $("#productTypeTwo").html("");
                    getProductTypeTwo(index)
                    getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
                })
            },
            error: function (jqXHR, textStatus, errorThrown) {
                // /*弹出jqXHR对象的信息*/
                // alert(jqXHR.responseText);
                // alert(jqXHR.status);
                // alert(jqXHR.readyState);
                // alert(jqXHR.statusText);
                // /*弹出其他两个参数的信息*/
                // alert(textStatus);
                // alert(errorThrown);
                alert('请求失败 ');
            }
        });

    }

    function getProductTypeTwo(typeid) {
        $.ajax({
            type: 'POST',
            // contentType: "application/json; charset=utf-8",
            contentType: "application/x-www-form-urlencoded",
            url: 'getParentType',
            dataType: "json",
            data: {"typeid": typeid},
            success: function (data) {
                var dataObj = eval("(" + data.massage + ")");
                var html = " <li class='productTypeIndex'>\n" +
                    "                        <a role=\"menuitem\" class='active' tabindex=\"0\" href=\"#\"> 全部</a>\n" +
                    "                    </li>";
                $.each(dataObj, function (index, obj) {
                    html += " <li class='productTypeIndex'>\n" +
                        "                        <a role=\"menuitem\" tabindex=\"" + obj.ftypeid + "\" href=\"#\"> " + obj.fName + "</a>\n" +
                        "                    </li>";
                })
                $("#productTypeTwo").html(html);
                $(".productTypeIndex").click(function () {
                    $("#pageIndex").html('1')
                    var obj = ($(this).find("a"))
                    var index = obj.attr("tabindex");
                    $("#productTypeSelect").html(index);
                    $(".productTypeIndex").find("a").removeClass("active");
                    $(this).find("a").addClass("active");
                    getProduct($("#productName").val(), $("#pageIndex").html(), $("#productTypeSelect").html(), $("#pageCount").html(), $("#productIsSall").html(), $("#productIsHot").html());
                })
            }
        });
    }
</script>